
In questo capitolo presentiamo la metodologia seguita per il design e la creazione delle applicazioni CAMUS, utilizzando un approccio di visual programming dei mashup. Abbiamo scelto di mettere l'utente finale al centro della nostra progettazione, tenendo conto delle sue esigenze di utilizzo, cercando di mascherare la complessità delle operazioni. %Esempio Viaggio???%
Nelle sezioni successive saranno esposti i problemi che abbiamo incontrato e le conseguenti scelte progettuali. 

\section{Modello del contesto\label{sec:modello-contesto}}

Come illustrato nella Sezione \ref{sec:context-awareness}, esistono diversi modelli per rappresentare il contesto. Ai fini del progetto si è resa necessaria la scelta di un modello che soddisfi le seguenti caratteristiche:

\begin{itemize}
	\item Permetta di rappresentare informazioni categoriche (??) e parametri (??)
	\item Deve consentire una rappresentazione gerarchica (es.: Mezzi di trasporto pubblici si può specializzare in bus, treno, car sharing, \dots)
	\item Deve essere facilmente personalizzabile ed adattarsi a diversi ambiti di utilizzo
	\item Deve possedere una rappresentazione visiva semplice e chiara, in modo che sia utilizzabile anche da persone non esperte di informatica
\end{itemize}

Tra i diversi modelli a disposizione, si è ritenuto che il Context Dimension Tree (CDT) sia il modello che rispetta maggiormente le richieste precedentemente elencate.

Oltre alla classificazione dei nodi originale del CDT, viene aggiunta un'ulteriore divisione in base al ruolo che un nodo può assumere durante la fase di selezione dei servizi:

\begin{itemize}
	\item \textbf{Nodo filtro} \`E la tipologia predefinita. I nodi di tipo filtro permettono, come si può dedurre dal nome, di filtrare i servizi che sono idonei all'uso in un determinato contesto
	\item \textbf{Nodo ranking} Questa tipologia viene assegnata ad alcuni nodi specifici, come ad esempio quello relativo alla \emph{località}, che assumono una maggiore importanza durante la selezione dei servizi, in quanto permettono di scegliere dei servizi che hanno un maggior impatto nel contesto specifico
\end{itemize}

\section{Creazione dell'ecosistema dei servizi\label{sec:ecosistema-servizi}}

I servizi rappresentano un punto cardine del sistema, in quanto mettono a disposizione le risorse che verranno mostrate all'utente. Si è deciso di dividere i servizi in due categorie ben distinte, in base alla funzionalità del servizio:

\begin{enumerate}
	\item \textbf{Primari} Sono i servizi che vengono interrogati in prima istanza per acquisire le informazioni di interesse relative al contesto nel quale si trova l'utente. Per esempio, se si effettua la ricerca di un ristorante, le informazioni principali saranno il nome del ristorante, l'indirizzo e il numero di telefono. TripAdvisor\footnote{\url{https://www.tripadvisor.it/}} e Zoomato\footnote{\url{https://www.zomato.com/it}} sono due esempi di servizi primari
	\item \textbf{Supporto} Sono i servizi che vengono utilizzati per arricchire le informazioni acquisite tramite i servizi primari. Possono mettere a disposizione dati aggiuntivi, contenuti multimediali (es.: foto e video) oppure possono fornire un'integrazione con altre app presenti sul dispositivo. Alcuni esempi di servizi di supporto sono le informazioni sul meteo, la cartina geografica del luogo o le indicazioni dei mezzi di trasporto per raggiungere il posto. Invece l'apertura del dialer telefonico quando viene selezionato il numero di telefono o l'utilizzo dell'app di navigazione preferita quando si sceglie un indirizzo rappresentano degli esempi di integrazione con altre app %Aggiungere anche degli esempi di servizi?
\end{enumerate}

Per quanto queste categorie rappresentino una divisione molto precisa dei servizi, non vengono considerate come rigide. Come già evidenziato in \cite{rizzo2015progettazione}, ogni servizio espone uno o più metodi, e non è detto che tutti rientrino nella medesima categoria. Può capitare che un servizio metta a disposizione un metodo che viene considerato primario ed un altro che invece fornisce informazioni di supporto. Si è deciso quindi di non effettuare una categorizzazione a livello di servizio, bensì per ogni operazione, in modo da garantire una maggiore flessibilità.

Per l'acquisizione dei dati è importante che il server sappia come interrogare i servizi e come interpretare le risposte. Si è deciso dunque di creare una repository con tutti i servizi che possono essere utilizzati dal sistema. Questa repository è composta dai \emph{descrittori dei servizi}, che contengono le informazioni necessarie per la gestione dei servizi. Ogni descrittore è composto da una prima parte comune relativa alle informazioni del servizio (es.: nome, categoria, url base, \dots) e da una parte specifica, costituita dall'elenco delle operazioni che espone. Ogni operazione rappresenta l'unità principale di ogni servizio, in quanto fornisce le seguenti informazioni che permettono di effettuare le richieste:

\begin{itemize}
	\item \textbf{Elenco dei parametri} Per interrogare un servizio è necessario comporre una query con i dati che si vogliono richiedere. Queste informazioni sono dipendenti dalla specifica implementazione del servizio e variano tra un servizio e l'altro. Nel descrittore vengono dunque elencati i parametri necessari per la composizione della query e dove andare a recuperare i relativi valori. L'acquisizione dei valori può avvenire secondo tre differenti modalità:
	\begin{enumerate}
		\item \emph{Default} Il valore viene impostato direttamente nel descrittore (es.: l'API key per l'autenticazione)
		\item \emph{Mapping CDT} Viene definita l'associazione con uno o più nodi del CDT e il valore viene recuperato in base alla selezione effettuata dall'utente (es.: le coordinate geografiche). Questi valori possono essere eventualmente trasformati da quelli simbolici del contesto ad un'altra rappresentazione adatta per effettuare la query (es.: dal valore \virgolette{Restaurant} del contesto viene associata la tipologia \virgolette{food})
		\item \emph{Mapping Term} Questa modalità viene utilizzata esclusivamente per i servizi di supporto e fornisce un placeholder nelle query che verrà rimpiazzato a runtime con il valore reale acquisito dalla risposta ricevuto o dal dispositivo
	\end{enumerate}
	\item \textbf{Schema della risposta} Per ottenere omogeneità tra le risposte ottenute dai diversi servizi, i dati ricevuti devono essere trasformati secondo uno schema comprensibile dalla mobile app. Per effettuare questa trasformazione vengono in aiuto i \emph{termini} (es.: titolo, indirizzo, descrizione, \dots), che rappresentano le classi semantiche di appartenenza degli attributi. L'elenco dei termini disponibili viene mantenuto in una repository come per i descrittori dei servizi. Queste annotazioni hanno una duplice utilità: in primo luogo, definendo il significato semantico di ogni attributo, semplificano l'integrazione dei dati provenienti da diversi servizi, in secondo luogo semplificano la creazione dei mashup, in quanto permettono di ragionare su categorie astratte di dati rispetto a dati reali forniti dai vari servizi e agevolano la riusabilità degli schemi in diversi contesti 
	\item \textbf{Gestione della paginazione} I dati che vengono restituiti a seguito di una query possono essere molteplici. Per semplificare la gestione delle risposte, i servizi implementano delle politiche di paginazione, dove vengono specificati il numero di risultati che si vogliono ottenere in una pagina e un numero che indica la pagina che è stata richiesta \cite{masse2011rest}. Questa sezione serve appositamente per indicare quali sono i parametri che vengono utilizzati dal servizio per richiamare le diverse pagine che compongono i risultati
\end{itemize}

\section{Associazione dei servizi al CDT\label{sec:associazione-servizi-cdt}}

Una volta che i servizi sono stati aggiunti alla repository è necessario specificare le associazioni che permettono la selezione dei servizi in base al contesto nel quale si trova l'utente.

Nel modello originale del CDT, presentato nella Sezione \ref{sec:context-awareness}, il processo di selezione dei dati rilevanti per un determinato contesto avveniva tramite la definizione di viste, che venivano create in linguaggio SQL e associate ai \virgolette{nodi valore}. Come evidenziato anche nella precedente ricerca \cite{rizzo2015progettazione}, questa metodologia non è più applicabile principalmente per due motivi:

\begin{enumerate}
	\item Si vuole rendere il funzionamento del sistema il più semplice possibile per essere utilizzato da persone che non hanno profonde conoscenze di informatica, e la scrittura di query in SQL non è alla portata di chiunque
	\item Non avendo a disposizione direttamente i dati, bensì i servizi da invocare per acquisirli, la selezione tramite viste non è la più idonea ad essere utilizzata
\end{enumerate}

Volendo mantenere un approccio che sia semplice e allo stesso tempo funzionale, si è deciso di associare le operazioni definite dai singoli servizi ai nodi dell'albero di contesto. 

\begin{figure}[h]
	\centering
	\includegraphics[width=\textwidth]{4-metodologia/Immagini/associazioni-cdt.png}
	\caption{Associazione dei servizi al CDT}\label{fig:associazione-servizi-cdt}
\end{figure}

Come si può notare dalla Figura \ref{fig:associazione-servizi-cdt}, le operazioni vengono associate ai nodi di tipo \virgolette{valore} o \virgolette{attributo}. Nel primo caso l'operazione viene aggiunta all'elenco di operazioni che ogni nodo definisce, nel secondo caso è necessario associare a quale/i valore/i associare l'operazione (es.: per il campo \virgolette{Città} bisogna definire il nome della città, invece per l'attributo \virgolette{Coordinate} è necessario specificare la latitudine e longitudine del luogo). Generalmente le associazioni vengono effettuate nei nodi foglia; resta tuttavia possibile effettuare delle associazioni anche nei nodi che hanno dei figli, quando per esempio un servizio copre diverse categorie e non ha senso che sia scelto in una sola di esse.

Per quanto riguarda i \emph{servizi primari}, quando vengono associati ad un determinato contesto viene definito anche un indice di \emph{priorità}: questo valore è un numero intero, a partire da 1 e crescente all'interno del singolo nodo. Definisce l'importanza che il servizio assume in quel determinato contesto e verrà utilizzato nella fase di selezione dei servizi illustrata nel Capitolo \ref{sec:primary-service-selection}. Questo indicatore ha senso di essere utilizzato esclusivamente nei \emph{nodi valore}, in quanto contengono una raccolta generica di servizi, mentre per i \emph{nodi attributo} non è necessario, in quanto l'ordinamento all'interno di una categoria di attributi non è sempre univoca. Se si prende per esempio un elenco di servizi associati ad una città tramite le sue coordinate geografiche, si può considerare come indice di priorità la lontananza rispetto all'utente, che può essere calcolata solamente a runtime e può variare spesso.

%bisogna parlare degli interest topic?
Per i \emph{servizi di supporto} non è sempre necessario definire le associazioni con i nodi del CDT. Alcuni servizi di supporto possono essere richiamati in modo statico quando non necessitano del contesto per essere scelti (es.: servizi generici come Wikipedia\footnote{\url{https://en.wikipedia.org/wiki/Main_Page}} o Flickr\footnote{\url{https://www.flickr.com/}}). Per altri servizi, come per esempio quelli relativi ai mezzi di trasporto, è invece necessario basarsi sul contesto per selezionare il servizio più idoneo alla situazione. Per esempio, se un utente specifica che non dispone di un'auto e che si trova a Milano, allora il sistema proporrà i mezzi di trasporto pubblici presenti nella città, insieme all'elenco di altri tipologie di trasporto come i taxi o il car sharing. In questo caso è dunque necessario, come per i servizi primari, definire le associazioni delle operazioni con i nodi del CDT. Il processo di associazione è simile a quello dei servizi primari, la principale differenza risiede nel fatto che non bisogna specificare la priorità dei servizi, mentre le altre assunzioni rimangono valide.

\section{CDT su misura per gli utenti}

\textcolor{red}{Divisione tra schema universale e tailored}\\

Il modello del CDT definito nella Sezione \ref{sec:associazione-servizi-cdt} viene chiamato \emph{CDT universale}, in quanto rappresenta lo schema più completo del quale il sistema può disporre.

\section{Mashup Design\label{sec:mashup-design}}

\textcolor{red}{Spiegare lo schema per la generazione dinamica delle schermate\\
Descrizione web app per la creazione degli schemi}

\section{Dove eseguire le query verso i servizi?}
%Non sono sicuro di mettere questa sezione qui, poi vediamo dove spostarla
Uno dei primi problemi che abbiamo dovuto affrontare è quello di pensare a come eseguire le richieste verso i servizi esterni. Le due principali soluzioni che vengono adottate nelle piattaforme di mashup per dispositivi mobile sono \emph{Server Mashup} e \emph{Cold Client Mashup} \textcolor{red}{(trovare qualche reference qui?)}
Nel Server Mashup tutte le operazioni vengono eseguite sul server, precisamente, dato un mashup, si occupa di tutte le operazioni di richiesta, integrazione e composizione dei dati, portando tutta la complessità delle operazioni sul server.
Il Cold Client Mashup, invece, lo schema di mashup viene scaricato sul dispositivo, quindi le operazioni di richiesta, integrazione e composizione vengono eseguite direttamente dal dispositivo.
Entrambe le soluzioni non sono molto bilanciate. Ha senso utilizzare il server come unico componente che esegue tutte le operazioni sui dati e usare l'app mobile solo come semplice browser dove a partire da una richiesta ottengo una o un insieme di risposte? Oppure ha senso spostare tutta la complessità computazionale sul dispositivo mobile?
Data la crescente potenza di calcolo dei processori destinati al comparto mobile la tentazione di far fare molte operazioni anche complesse al dispositivo mobile è molto forte, tuttavia questo non risolve diverse problematiche.
I servizi non è detto che abbiano i medesimi tempi di risposta, quindi l'applicazione per eseguire una query dovrebbe avere una propria cache. Questo inoltre aggiunge un problema con le API keys dei servizi, che nel caso in cui fossero limitate, porterebbero ad eseguire tante richieste, portando a costi maggiori o a un esaurimento di queries verso il servizio. Questo problema verrebbe risolto utilizzando un unico punto di esecuzione delle query con un meccanismo di caching, in modo da evitare ripetizioni di richieste, tentando di ridurre l'incidenza di questo problema.
Esistono altri due problemi, i quali sono legati all'autonomia e all'utilizzo dei dati del mobile device. L'esecuzione di richieste e operazioni sui dati porta ovviamente a un maggiore consumo di risorse hardware di calcolo e di telecomunicazione, consumando maggiormente la batteria integrata. Con una query unica e con i dati già aggregati ovviamente riduce il consumo delle risorse energetiche e dei dati in connessione mobile.

\section{Architettura utilizzata\label{sec:architettura-sistema}}

\begin{figure}[h]
	\centering
	\includegraphics[width=\textwidth]{4-metodologia/Immagini/ArchitectureGen2016.png}
	\caption{Architettura del sistema}\label{fig:architettura-sistema}
\end{figure}

Come evidenziato nella figura \ref{fig:architettura-sistema}, l'architettura finale del sistema CAMUS è composta da tre parti, ognuna delle quali è collegata con l'utente finale del sistema.

\begin{enumerate}
	\item \textbf{Server} Il server è l'endpoint al quale si interfaccia l'amministratore del sistema, il quale ha una visione maggiore della complessità del sistema. Ha il compito di aggiungere i servizi disponibili compilando un campo Qui vengono registrati i servizi poi che vengono mappati dall'esperto nelle \emph{Web App} 
	Data una query proveniente dall'applicazione mobile, comprendente il contesto e i dati che ha bisogno il client,il server seleziona i servizi da contattare tramite il \emph{Service Selector}, esegue le query verso i servizi esterni e compone i risultati a seconda a seconda delle regole associate a ciascun servizio.
	
	\item \textbf{Web App} Le web app sono collegate all'esperto di settore che compone l'applicazione mobile. Questo attore non è necessariamente un esperto di informatica e della tecnologia utilizzata, quindi ha bisogno di un astrazione maggiore rispetto all'amministratore. Sono disponibili due funzionalità di base: una permette di associare i servizi al CDT dell'utente, mentre l'altra permette di creare i mashup per le pagine dell'applicazione, collegando i termini con i componenti che verranno poi renderizzati nell'applicazione.
	
	\item \textbf{App Mobile} La app mobile è l'interfaccia dell'utente finale con il sistema. Essa ha il compito di renderizzare i mashup definiti dall'esperto e di permettere all'utente di inserire il proprio contesto per richiedere al server i risultati associati ad esso. I dati occorrenti per generare un contesto possono essere anche aggiunti utilizzando i sensori del dispositivo, come il GPS o l'ora corrente.
\end{enumerate}





